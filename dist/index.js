!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("AutoProgress",e):t.AutoProgress=e()}(this,function(){"use strict";function t(t){return Array.prototype.slice.call(t)}function n(t,e,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!t[e])throw"Old function does not exist!";null===o&&(o=t);var i={callback:function(t){r=t}},a=t[e];return t[e]=function(){for(var e=arguments.length,i=Array(e),s=0;s<e;s++)i[s]=arguments[s];n.apply(o,i);var c=a.apply(t,i);if(r){var u=r.call(o,c);u&&null!==u&&(c=u)}return c},i}function r(){var t=document.createDocumentFragment();this.addEventListener=function(e,n,r,o){return t.addEventListener(e,n,r,o)},this.dispatchEvent=function(e){var n="on"+e.type;return this[n]&&this[n](e),t.dispatchEvent(e)}.bind(this),this.removeEventListener=function(e,n,r){return t.removeEventListener(e,n,r)}}function o(){var t=this;r.call(this),this.total=0,this.done=0,this.weight=1,this.waiting=!1,this.options={waitAfterStart:100};var e=new Event("progress");this.handleElement=function(){0!=t.total&&t.done!=t.total&&(t.done++,t.dispatchEvent(e))},this.getProgress=function(){return 0===t.total?t.waiting?0:100:t.done/t.total*100};var n=null;this.start=function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(t.total=0,t.done=0),null!==n&&clearTimeout(n),t.waiting=!0,n=setTimeout(function(){t.waiting=!1,t.search&&t.search(),0==t.total&&t.dispatchEvent(e),n=null},t.options.waitAfterStart)}}function i(){o.call(this);var t=this,e=window.XMLHttpRequest;window.XMLHttpRequest=function(){var r=new e;return n(r,"send",function(){return t.total++}),r.addEventListener("load",function(e){return t.handleElement()}),r.addEventListener("error",function(e){return t.handleElement()}),r}}function a(){o.call(this),n(window,"fetch",function(){this.total++},this).callback(function(t){var e=this;return t.then(function(t){return e.handleElement(),t})})}function s(){var n=this;o.call(this);var r=[],i=[function(e){t(document.querySelectorAll("img")).forEach(function(t){t.complete||r.includes(t)||(n.total++,t.addEventListener("load",e),t.addEventListener("error",e),r.push(t))})},function(o){t(document.querySelectorAll("audio")).concat(t(document.querySelectorAll("video"))).forEach(function(t){t.readyState<2||r.includes(e)||(n.total++,"auto"==t.preload||t.autoplay?(t.addEventListener("canplay",o),t.addEventListener("error",o)):o(),r.push(e))})}];this.search=function(){i.forEach(function(t){return t(n.handleElement)})},document.onreadystatechange=function(t){"interactive"==document.readyState?(n.search(),n.total++):"complete"==document.readyState&&n.handleElement()}}return Array.prototype.forEach||(Array.prototype.forEach=function(t){var e,n;if(null==this)throw new TypeError("this is null or not defined");var r=Object(this),o=r.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(e=arguments[1]),n=0;n<o;){var i;n in r&&(i=r[n],t.call(e,i,n,r)),n++}}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,r=function(){},o=function(){return n.apply(this instanceof r&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,o.prototype=new r,o}),function(){if("function"==typeof window.CustomEvent||"function"==typeof window.Event)return!1;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}t.prototype=window.Event.prototype,window.Event=t}(),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),r=n.length>>>0;if(0===r)return!1;var o,i,a=0|e,s=Math.max(a>=0?a:r-Math.abs(a),0);for(;s<r;){if((o=n[s])===(i=t)||"number"==typeof o&&"number"==typeof i&&isNaN(o)&&isNaN(i))return!0;s++}return!1}}),new function(){var t=this;r.call(this);var e={},o=0,c=[],u={progress:new Event("progress"),finished:new Event("finished")},l=function(){var e,n;100!=o&&(e=0,n=0,c.forEach(function(t){var r=t.weight||1;n+=r*t.getProgress(),e+=r}),o=n/e,t.dispatchEvent(u.progress),100==o&&t.dispatchEvent(u.finished))},f=function(t){var e=new t;return e.start(!1),c.push(e),l(),e.addEventListener("progress",l),e};f(i),window.fetch&&"function"==typeof window.fetch&&f(a),f(s);var h=!0,d=1e3;this.restart=function(){h&&(o=0,c.forEach(function(t){return t.start(!0)}),l(),0!=d&&(h=!1,setTimeout(function(){h=!0},d)))},this.getProgress=function(){return o},this.setLoadTimeout=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3;setTimeout(function(){100!=o&&(o=100,t.dispatchEvent(u.progress),t.dispatchEvent(u.finished))},e)},this.setOption=function(r,o){if("restartCooldown"==r&&!isNaN(o)&&o>0)d=o;else if("restartOnPopstate"==r&&window.history&&o!==e[r])if(e[r]=o,o){var i=function(){e.restartOnPopstate&&t.restart()};n(window.history,"pushState",i,t),n(window.history,"replaceState",i,t),window.addEventListener("popstate",t.restart)}else window.offEventListener("popstate",t.restart);else if("restartOnHashChange"==r||!window.history&&"fallbackHashChange"==r){if(o===e[r])return;e[r]=o,o?window.addEventListener("hashchange",t.restart):window.offEventListener("hashchange",t.restart)}else for(var a in t.trackers)t.trackers[a].options&&t.trackers[a].options[r]&&(t.trackers[a].options[r]=o)},this.setOptions=function(e){for(var n in e)t.setOption(n,e[n])},this.setOptions({restartOnPopstate:!0,fallbackHashChange:!0,restartCooldown:1e3})}});